version: "3.8"

services:
  openclaw-gateway:
    build:
      context: .
      args:
        GOG_VERSION: ${GOG_VERSION:-0.10.0}
    image: openclaw-gateway:gog
    container_name: openclaw-gateway
    restart: unless-stopped
    init: true

    environment:
      OPENCLAW_GATEWAY_TOKEN: "${OPENCLAW_GATEWAY_TOKEN}"
      HOME: /home/node
      TERM: xterm-256color
      XDG_CONFIG_HOME: /home/node/.openclaw/.config
      XDG_DATA_HOME: /home/node/.openclaw/.local/share

    volumes:
      # IMPORTANT: persistance openclaw + tokens OAuth
      - "${OPENCLAW_CONFIG_DIR}:/home/node/.openclaw"
      - "${OPENCLAW_WORKSPACE_DIR}:/home/node/.openclaw/workspace"

    ports:
      - "${OPENCLAW_GATEWAY_PORT:-18789}:18789"
      - "${OPENCLAW_BRIDGE_PORT:-18790}:18790"

    # Commande gateway standard (adapte si tu avais déjà des flags spécifiques)
    command: ["node","dist/index.js","gateway","--bind","${OPENCLAW_GATEWAY_BIND:-lan}","--port","18789"]
